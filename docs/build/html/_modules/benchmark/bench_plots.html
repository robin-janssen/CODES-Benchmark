<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>benchmark.bench_plots &#8212; CODES Benchmark 09.09.2024 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=c058f7c8" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=27fed22d" />
    <script src="../../_static/documentation_options.js?v=47c521fd"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for benchmark.bench_plots</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">ListedColormap</span>
<span class="kn">from</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">import</span> <span class="n">GridSpec</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">gaussian_filter1d</span>

<span class="kn">from</span> <span class="nn">.bench_utils</span> <span class="kn">import</span> <span class="n">format_time</span>

<span class="c1"># Utility functions for plotting</span>


<div class="viewcode-block" id="save_plot">
<a class="viewcode-back" href="../../benchmark.html#benchmark.save_plot">[docs]</a>
<span class="k">def</span> <span class="nf">save_plot</span><span class="p">(</span>
    <span class="n">plt</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">conf</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">surr_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the plot to a file, creating necessary directories if they don&#39;t exist.</span>

<span class="sd">    Args:</span>
<span class="sd">        plt (matplotlib.pyplot): The plot object to save.</span>
<span class="sd">        filename (str): The desired filename for the plot.</span>
<span class="sd">        conf (dict): The configuration dictionary.</span>
<span class="sd">        surr_name (str): The name of the surrogate model.</span>
<span class="sd">        dpi (int): The resolution of the saved plot.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If the configuration dictionary does not contain the required keys.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;training_id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">conf</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Configuration dictionary must contain &#39;training_id&#39;.&quot;</span><span class="p">)</span>

    <span class="n">training_id</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;training_id&quot;</span><span class="p">]</span>
    <span class="n">plot_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;plots&quot;</span><span class="p">,</span> <span class="n">training_id</span><span class="p">,</span> <span class="n">surr_name</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">plot_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">plot_dir</span><span class="p">)</span>

    <span class="n">filepath</span> <span class="o">=</span> <span class="n">save_plot_counter</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">plot_dir</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;verbose&quot;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plot saved as: </span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="save_plot_counter">
<a class="viewcode-back" href="../../benchmark.html#benchmark.save_plot_counter">[docs]</a>
<span class="k">def</span> <span class="nf">save_plot_counter</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save a plot with an incremented filename if a file with the same name already exists.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): The desired filename for the plot.</span>
<span class="sd">        directory (str): The directory to save the plot in.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The full path to the saved plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

    <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filepath</span><span class="p">):</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">base</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">counter</span><span class="si">}{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">filepath</span></div>



<span class="c1"># Per-surrogate model plots</span>


<div class="viewcode-block" id="plot_relative_errors_over_time">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_relative_errors_over_time">[docs]</a>
<span class="k">def</span> <span class="nf">plot_relative_errors_over_time</span><span class="p">(</span>
    <span class="n">surr_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">conf</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">relative_errors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the mean and median relative errors over time with shaded regions for</span>
<span class="sd">    the 50th, 90th, and 99th percentiles.</span>

<span class="sd">    Args:</span>
<span class="sd">        surr_name (str): The name of the surrogate model.</span>
<span class="sd">        conf (dict): The configuration dictionary.</span>
<span class="sd">        relative_errors (np.ndarray): The relative errors of the model.</span>
<span class="sd">        title (str): The title of the plot.</span>
<span class="sd">        save (bool): Whether to save the plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Calculate the mean, median, and percentiles across all samples and chemicals</span>
    <span class="n">mean_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">relative_errors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mean_errors</span><span class="p">)</span>
    <span class="n">median_errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">relative_errors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">median_errors</span><span class="p">)</span>
    <span class="n">p50_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">relative_errors</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">p50_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">relative_errors</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">p90_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">relative_errors</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">p90_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">relative_errors</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">p99_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">relative_errors</span><span class="p">,</span> <span class="mf">99.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">p99_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">relative_errors</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

    <span class="n">timesteps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">relative_errors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">mean_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mean Error (Mean: </span><span class="si">{</span><span class="n">mean</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> %)&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">mean_errors</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">mean_label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
    <span class="n">median_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Median Error (Median: </span><span class="si">{</span><span class="n">median</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> %)&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">median_errors</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">median_label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>

    <span class="c1"># Shading areas</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
        <span class="n">timesteps</span><span class="p">,</span>
        <span class="n">p50_lower</span><span class="p">,</span>
        <span class="n">p50_upper</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.45</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;50th Percentile&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
        <span class="n">timesteps</span><span class="p">,</span>
        <span class="n">p90_lower</span><span class="p">,</span>
        <span class="n">p90_upper</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;90th Percentile&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
        <span class="n">timesteps</span><span class="p">,</span>
        <span class="n">p99_lower</span><span class="p">,</span>
        <span class="n">p99_upper</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;99th Percentile&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Timestep&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Relative Error&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">timesteps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">timesteps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">conf</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="s2">&quot;accuracy_rel_errors_time.png&quot;</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">surr_name</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="plot_dynamic_correlation">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_dynamic_correlation">[docs]</a>
<span class="k">def</span> <span class="nf">plot_dynamic_correlation</span><span class="p">(</span>
    <span class="n">surr_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">conf</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">gradients</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">errors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the correlation between the gradients of the data and the prediction errors.</span>

<span class="sd">    Args:</span>
<span class="sd">        surr_name (str): The name of the surrogate model.</span>
<span class="sd">        conf (dict): The configuration dictionary.</span>
<span class="sd">        gradients (np.ndarray): The gradients of the data.</span>
<span class="sd">        errors (np.ndarray): The prediction errors.</span>
<span class="sd">        save (bool): Whether to save the plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Flatten the arrays for correlation plot</span>
    <span class="n">gradients_flat</span> <span class="o">=</span> <span class="n">gradients</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">errors_flat</span> <span class="o">=</span> <span class="n">errors</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="c1"># Scatter plot of gradients vs. errors</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">gradients_flat</span><span class="p">,</span> <span class="n">errors_flat</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Gradient of Data&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Prediction Error&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Correlation between Gradients and Prediction Errors&quot;</span><span class="p">)</span>

    <span class="c1"># Save the plot</span>
    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">conf</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="s2">&quot;gradient_error_correlation.png&quot;</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">surr_name</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="plot_generalization_errors">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_generalization_errors">[docs]</a>
<span class="k">def</span> <span class="nf">plot_generalization_errors</span><span class="p">(</span>
    <span class="n">surr_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">conf</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">metrics</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">model_errors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the generalization errors of a model for various metrics.</span>

<span class="sd">    Args:</span>
<span class="sd">        surr_name (str): The name of the surrogate model.</span>
<span class="sd">        conf (dict): The configuration dictionary.</span>
<span class="sd">        metrics (np.ndarray): The metrics (e.g., intervals, cutoffs, batch sizes, number of training samples).</span>
<span class="sd">        model_errors (np.ndarray): The model errors.</span>
<span class="sd">        mode (str): The mode of generalization (&quot;interpolation&quot;, &quot;extrapolation&quot;, &quot;sparse&quot;, &quot;batchsize&quot;).</span>
<span class="sd">        save (bool): Whether to save the plot.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;interpolation&quot;</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Interpolation Interval&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Interpolation Errors&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;interpolation_errors.png&quot;</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;extrapolation&quot;</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Extrapolation Cutoff&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Extrapolation Errors&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;extrapolation_errors.png&quot;</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;sparse&quot;</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Number of Training Samples&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Sparse Training Errors&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;sparse_errors.png&quot;</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;batchsize&quot;</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Batch Size&quot;</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Batch Size Training Errors&quot;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;batchsize_errors.png&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid mode. Choose from &#39;interpolation&#39;, &#39;extrapolation&#39;, &#39;sparse&#39;, &#39;batchsize&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">metrics</span><span class="p">,</span> <span class="n">model_errors</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">surr_name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#3A1A5A&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;sparse&quot;</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;batchsize&quot;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Mean Squared Error&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">conf</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">surr_name</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="plot_average_errors_over_time">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_average_errors_over_time">[docs]</a>
<span class="k">def</span> <span class="nf">plot_average_errors_over_time</span><span class="p">(</span>
    <span class="n">surr_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">conf</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">errors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">metrics</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">timesteps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the errors over time for different modes (interpolation, extrapolation, sparse, batchsize).</span>

<span class="sd">    Args:</span>
<span class="sd">        surr_name (str): The name of the surrogate model.</span>
<span class="sd">        conf (dict): The configuration dictionary.</span>
<span class="sd">        errors (np.ndarray): Errors array of shape [N_metrics, n_timesteps].</span>
<span class="sd">        metrics (np.ndarray): Metrics array of shape [N_metrics].</span>
<span class="sd">        timesteps (np.ndarray): Timesteps array.</span>
<span class="sd">        mode (str): The mode of evaluation (&#39;interpolation&#39;, &#39;extrapolation&#39;, &#39;sparse&#39;, &#39;batchsize&#39;).</span>
<span class="sd">        save (bool, optional): Whether to save the plot as a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;interpolation&quot;</span><span class="p">:</span> <span class="s2">&quot;interval&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extrapolation&quot;</span><span class="p">:</span> <span class="s2">&quot;cutoff&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sparse&quot;</span><span class="p">:</span> <span class="s2">&quot;samples&quot;</span><span class="p">,</span>
        <span class="s2">&quot;batchsize&quot;</span><span class="p">:</span> <span class="s2">&quot;batch size&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Invalid mode. Choose from &#39;interpolation&#39;, &#39;extrapolation&#39;, &#39;sparse&#39;, &#39;batchsize&#39;.&quot;</span>
        <span class="p">)</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">magma</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="n">errors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;sparse&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">metrics</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">labels</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">errors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">metrics</span><span class="p">):</span>
            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">labels</span><span class="p">[</span><span class="n">mode</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">errors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;extrapolation&quot;</span><span class="p">:</span>
                <span class="n">cutoff_point</span> <span class="o">=</span> <span class="n">timesteps</span><span class="p">[</span><span class="n">metric</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">cutoff_point</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span>
                <span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                    <span class="n">cutoff_point</span><span class="p">,</span>
                    <span class="n">errors</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">metric</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">timesteps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">timesteps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Mean Absolute Error&quot;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2"> Errors Over Time&quot;</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">_errors_over_time.png&quot;</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">conf</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">surr_name</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="plot_example_predictions_with_uncertainty">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_example_predictions_with_uncertainty">[docs]</a>
<span class="k">def</span> <span class="nf">plot_example_predictions_with_uncertainty</span><span class="p">(</span>
    <span class="n">surr_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">conf</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">preds_mean</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">preds_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">targets</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">timesteps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">example_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">num_chemicals</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot example predictions with uncertainty.</span>

<span class="sd">    Args:</span>
<span class="sd">        surr_name (str): The name of the surrogate model.</span>
<span class="sd">        conf (dict): The configuration dictionary.</span>
<span class="sd">        preds_mean (np.ndarray): Mean predictions from the ensemble of models.</span>
<span class="sd">        preds_std (np.ndarray): Standard deviation of predictions from the ensemble of models.</span>
<span class="sd">        targets (np.ndarray): True targets.</span>
<span class="sd">        timesteps (np.ndarray): Timesteps array.</span>
<span class="sd">        example_idx (int, optional): Index of the example to plot. Default is 0.</span>
<span class="sd">        num_chemicals (int, optional): Number of chemicals to plot. Default is 100.</span>
<span class="sd">        labels (list, optional): List of labels for the chemicals.</span>
<span class="sd">        save (bool, optional): Whether to save the plot as a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Cap the number of chemicals at 100</span>
    <span class="n">num_chemicals</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">preds_std</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">num_chemicals</span><span class="p">)</span>

    <span class="c1"># Determine the number of plots needed</span>
    <span class="n">chemicals_per_plot</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">num_plots</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">num_chemicals</span> <span class="o">/</span> <span class="n">chemicals_per_plot</span><span class="p">))</span>

    <span class="c1"># Define the color palette</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">chemicals_per_plot</span><span class="p">))</span>

    <span class="c1"># Create subplots</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">num_plots</span><span class="p">))</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="n">num_plots</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>  <span class="c1"># Single column of plots</span>

    <span class="k">for</span> <span class="n">plot_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_plots</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">])</span>

        <span class="n">start_idx</span> <span class="o">=</span> <span class="n">plot_idx</span> <span class="o">*</span> <span class="n">chemicals_per_plot</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">plot_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">chemicals_per_plot</span><span class="p">,</span> <span class="n">num_chemicals</span><span class="p">)</span>

        <span class="n">legend_lines</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># To store the line objects for the legend</span>

        <span class="k">for</span> <span class="n">chem_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">):</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">chem_idx</span> <span class="o">%</span> <span class="n">chemicals_per_plot</span><span class="p">]</span>
            <span class="n">gt</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[</span><span class="n">example_idx</span><span class="p">,</span> <span class="p">:,</span> <span class="n">chem_idx</span><span class="p">]</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">preds_mean</span><span class="p">[</span><span class="n">example_idx</span><span class="p">,</span> <span class="p">:,</span> <span class="n">chem_idx</span><span class="p">]</span>
            <span class="n">std</span> <span class="o">=</span> <span class="n">preds_std</span><span class="p">[</span><span class="n">example_idx</span><span class="p">,</span> <span class="p">:,</span> <span class="n">chem_idx</span><span class="p">]</span>

            <span class="c1"># Plot ground truth and store the line object</span>
            <span class="p">(</span><span class="n">gt_line</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">gt</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="c1"># Plot prediction mean and store the line object</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

            <span class="c1"># Store only the ground truth line in legend_lines</span>
            <span class="n">legend_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gt_line</span><span class="p">)</span>

            <span class="c1"># Plot standard deviations as shaded areas</span>
            <span class="k">for</span> <span class="n">sigma_multiplier</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>  <span class="c1"># 1, 2, and 3 standard deviations</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
                    <span class="n">timesteps</span><span class="p">,</span>
                    <span class="n">mean</span> <span class="o">-</span> <span class="n">sigma_multiplier</span> <span class="o">*</span> <span class="n">std</span><span class="p">,</span>
                    <span class="n">mean</span> <span class="o">+</span> <span class="n">sigma_multiplier</span> <span class="o">*</span> <span class="n">std</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span> <span class="o">/</span> <span class="n">sigma_multiplier</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Set the y-axis label for each subplot</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;log(Chemical Abundance)&quot;</span><span class="p">)</span>

        <span class="c1"># Create a legend directly next to the plot using the stored line objects</span>
        <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">legend_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">start_idx</span><span class="p">:</span><span class="n">end_idx</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
                <span class="n">legend_lines</span><span class="p">,</span>
                <span class="n">legend_labels</span><span class="p">,</span>
                <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center left&quot;</span><span class="p">,</span>
                <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>  <span class="c1"># Position legend to the right of the plot</span>
                <span class="n">bbox_transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>  <span class="c1"># Place it relative to the axes</span>
                <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Chemical Labels&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Set the x limit exactly from the lowest to the highest timestep</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">timesteps</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">timesteps</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="c1"># Add a single x-axis label to the bottom plot</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="c1"># Create a general legend for line styles, positioned below the title</span>
    <span class="n">handles</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Ground Truth&quot;</span><span class="p">),</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediction (Ensemble Mean)&quot;</span>
        <span class="p">),</span>
    <span class="p">]</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
        <span class="n">handles</span><span class="o">=</span><span class="n">handles</span><span class="p">,</span>
        <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">,</span>
        <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.93</span><span class="p">),</span>  <span class="c1"># Adjust to position the legend below the title</span>
        <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Adjust the title to include the sample index and place additional information on a second line</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;DeepEnsemble: Example Predictions with Uncertainty for </span><span class="si">{</span><span class="n">surr_name</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Sample Index: </span><span class="si">{</span><span class="n">example_idx</span><span class="si">}</span><span class="s2">,  &quot;</span> <span class="o">+</span> <span class="sa">r</span><span class="s2">&quot;$\mu \pm (1,2,3) \sigma$ Intervals&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="mf">0.97</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.92</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">conf</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="s2">&quot;uncertainty_deepensemble_preds.png&quot;</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">surr_name</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="plot_average_uncertainty_over_time">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_average_uncertainty_over_time">[docs]</a>
<span class="k">def</span> <span class="nf">plot_average_uncertainty_over_time</span><span class="p">(</span>
    <span class="n">surr_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">conf</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">errors_time</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">preds_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">timesteps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the average uncertainty over time.</span>

<span class="sd">    Args:</span>
<span class="sd">        surr_name (str): The name of the surrogate model.</span>
<span class="sd">        conf (dict): The configuration dictionary.</span>
<span class="sd">        errors_time (np.ndarray): Prediction errors over time.</span>
<span class="sd">        preds_std (np.ndarray): Standard deviation over time of predictions from the ensemble of models.</span>
<span class="sd">        timesteps (np.ndarray): Timesteps array.</span>
<span class="sd">        save (bool, optional): Whether to save the plot as a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">errors_time</span><span class="p">)</span>
    <span class="n">preds_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">preds_std</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">errors_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mean Uncertainty (Mean: </span><span class="si">{</span><span class="n">preds_mean</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="n">preds_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mean Absolute Error (Mean: </span><span class="si">{</span><span class="n">errors_mean</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">preds_std</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">preds_label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#3A1A5A&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timesteps</span><span class="p">,</span> <span class="n">errors_time</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">errors_label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#DA5F4D&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Average Uncertainty / Mean Absolute Error&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">timesteps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">timesteps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Average Uncertainty and Mean Absolute Error Over Time&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">conf</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="s2">&quot;uncertainty_over_time.png&quot;</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">surr_name</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="plot_uncertainty_vs_errors">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_uncertainty_vs_errors">[docs]</a>
<span class="k">def</span> <span class="nf">plot_uncertainty_vs_errors</span><span class="p">(</span>
    <span class="n">surr_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">conf</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">preds_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">errors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the correlation between predictive uncertainty and prediction errors.</span>

<span class="sd">    Args:</span>
<span class="sd">        surr_name (str): The name of the surrogate model.</span>
<span class="sd">        conf (dict): The configuration dictionary.</span>
<span class="sd">        preds_std (np.ndarray): Standard deviation of predictions from the ensemble of models.</span>
<span class="sd">        errors (np.ndarray): Prediction errors.</span>
<span class="sd">        save (bool, optional): Whether to save the plot as a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Normalize the errors</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">errors</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">preds_std</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">errors</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Predictive Uncertainty&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Prediction Error (Normalized)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Correlation between Predictive Uncertainty and Prediction Errors&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">conf</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="s2">&quot;uncertainty_vs_errors.png&quot;</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">surr_name</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="plot_surr_losses">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_surr_losses">[docs]</a>
<span class="k">def</span> <span class="nf">plot_surr_losses</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">surr_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">conf</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">timesteps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the training and test losses for the surrogate model.</span>

<span class="sd">    Args:</span>
<span class="sd">        model: Instance of the surrogate model class.</span>
<span class="sd">        surr_name (str): The name of the surrogate model.</span>
<span class="sd">        conf (dict): The configuration dictionary.</span>
<span class="sd">        timesteps (np.ndarray): The timesteps array.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">training_id</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;training_id&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">load_losses</span><span class="p">(</span><span class="n">model_identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">model</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">training_id</span><span class="p">,</span> <span class="n">surr_name</span><span class="p">,</span> <span class="n">model_identifier</span><span class="o">=</span><span class="n">model_identifier</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">train_loss</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">test_loss</span>

    <span class="c1"># Main model losses</span>
    <span class="n">main_train_loss</span><span class="p">,</span> <span class="n">main_test_loss</span> <span class="o">=</span> <span class="n">load_losses</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">surr_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_main&quot;</span><span class="p">)</span>
    <span class="n">plot_losses</span><span class="p">(</span>
        <span class="p">(</span><span class="n">main_train_loss</span><span class="p">,</span> <span class="n">main_test_loss</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Train Loss&quot;</span><span class="p">,</span> <span class="s2">&quot;Test Loss&quot;</span><span class="p">),</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Main Model Losses&quot;</span><span class="p">,</span>
        <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">conf</span><span class="o">=</span><span class="n">conf</span><span class="p">,</span>
        <span class="n">surr_name</span><span class="o">=</span><span class="n">surr_name</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Interpolation losses</span>
    <span class="k">if</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;interpolation&quot;</span><span class="p">][</span><span class="s2">&quot;enabled&quot;</span><span class="p">]:</span>
        <span class="n">intervals</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;interpolation&quot;</span><span class="p">][</span><span class="s2">&quot;intervals&quot;</span><span class="p">]</span>
        <span class="n">interp_train_losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">main_train_loss</span><span class="p">]</span>
        <span class="n">interp_test_losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">main_test_loss</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">interval</span> <span class="ow">in</span> <span class="n">intervals</span><span class="p">:</span>
            <span class="n">train_loss</span><span class="p">,</span> <span class="n">test_loss</span> <span class="o">=</span> <span class="n">load_losses</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">surr_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_interpolation_</span><span class="si">{</span><span class="n">interval</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">interp_train_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">train_loss</span><span class="p">)</span>
            <span class="n">interp_test_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_loss</span><span class="p">)</span>
        <span class="n">plot_losses</span><span class="p">(</span>
            <span class="nb">tuple</span><span class="p">(</span><span class="n">interp_train_losses</span><span class="p">),</span>
            <span class="nb">tuple</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Interval </span><span class="si">{</span><span class="n">interval</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">interval</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">intervals</span><span class="p">),</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Interpolation Losses&quot;</span><span class="p">,</span>
            <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">conf</span><span class="o">=</span><span class="n">conf</span><span class="p">,</span>
            <span class="n">surr_name</span><span class="o">=</span><span class="n">surr_name</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;interpolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Extrapolation losses</span>
    <span class="k">if</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;extrapolation&quot;</span><span class="p">][</span><span class="s2">&quot;enabled&quot;</span><span class="p">]:</span>
        <span class="n">cutoffs</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;extrapolation&quot;</span><span class="p">][</span><span class="s2">&quot;cutoffs&quot;</span><span class="p">]</span>
        <span class="n">extra_train_losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">main_train_loss</span><span class="p">]</span>
        <span class="n">extra_test_losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">main_test_loss</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">cutoff</span> <span class="ow">in</span> <span class="n">cutoffs</span><span class="p">:</span>
            <span class="n">train_loss</span><span class="p">,</span> <span class="n">test_loss</span> <span class="o">=</span> <span class="n">load_losses</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">surr_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_extrapolation_</span><span class="si">{</span><span class="n">cutoff</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">extra_train_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">train_loss</span><span class="p">)</span>
            <span class="n">extra_test_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_loss</span><span class="p">)</span>
        <span class="n">plot_losses</span><span class="p">(</span>
            <span class="nb">tuple</span><span class="p">(</span><span class="n">extra_train_losses</span><span class="p">),</span>
            <span class="nb">tuple</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cutoff </span><span class="si">{</span><span class="n">cutoff</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">cutoff</span> <span class="ow">in</span> <span class="n">cutoffs</span> <span class="o">+</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">timesteps</span><span class="p">)]),</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Extrapolation Losses&quot;</span><span class="p">,</span>
            <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">conf</span><span class="o">=</span><span class="n">conf</span><span class="p">,</span>
            <span class="n">surr_name</span><span class="o">=</span><span class="n">surr_name</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;extrapolation&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Sparse losses</span>
    <span class="k">if</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;sparse&quot;</span><span class="p">][</span><span class="s2">&quot;enabled&quot;</span><span class="p">]:</span>
        <span class="n">factors</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;sparse&quot;</span><span class="p">][</span><span class="s2">&quot;factors&quot;</span><span class="p">]</span>
        <span class="n">sparse_train_losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">main_train_loss</span><span class="p">]</span>
        <span class="n">sparse_test_losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">main_test_loss</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">factor</span> <span class="ow">in</span> <span class="n">factors</span><span class="p">:</span>
            <span class="n">train_loss</span><span class="p">,</span> <span class="n">test_loss</span> <span class="o">=</span> <span class="n">load_losses</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">surr_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_sparse_</span><span class="si">{</span><span class="n">factor</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">sparse_train_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">train_loss</span><span class="p">)</span>
            <span class="n">sparse_test_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_loss</span><span class="p">)</span>
        <span class="n">plot_losses</span><span class="p">(</span>
            <span class="nb">tuple</span><span class="p">(</span><span class="n">sparse_train_losses</span><span class="p">),</span>
            <span class="nb">tuple</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Factor </span><span class="si">{</span><span class="n">factor</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">factor</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">factors</span><span class="p">),</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Sparse Losses&quot;</span><span class="p">,</span>
            <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">conf</span><span class="o">=</span><span class="n">conf</span><span class="p">,</span>
            <span class="n">surr_name</span><span class="o">=</span><span class="n">surr_name</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;sparse&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># UQ losses</span>
    <span class="k">if</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">][</span><span class="s2">&quot;enabled&quot;</span><span class="p">]:</span>
        <span class="n">n_models</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;uncertainty&quot;</span><span class="p">][</span><span class="s2">&quot;ensemble_size&quot;</span><span class="p">]</span>
        <span class="n">uq_train_losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">main_train_loss</span><span class="p">]</span>
        <span class="n">uq_test_losses</span> <span class="o">=</span> <span class="p">[</span><span class="n">main_test_loss</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_models</span><span class="p">):</span>
            <span class="n">train_loss</span><span class="p">,</span> <span class="n">test_loss</span> <span class="o">=</span> <span class="n">load_losses</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">surr_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_UQ_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">uq_train_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">train_loss</span><span class="p">)</span>
            <span class="n">uq_test_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_loss</span><span class="p">)</span>
        <span class="n">plot_losses</span><span class="p">(</span>
            <span class="nb">tuple</span><span class="p">(</span><span class="n">uq_train_losses</span><span class="p">),</span>
            <span class="nb">tuple</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_models</span><span class="p">)),</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;UQ Losses&quot;</span><span class="p">,</span>
            <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">conf</span><span class="o">=</span><span class="n">conf</span><span class="p">,</span>
            <span class="n">surr_name</span><span class="o">=</span><span class="n">surr_name</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;UQ&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Batchsize losses</span>
    <span class="k">if</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;batch_scaling&quot;</span><span class="p">][</span><span class="s2">&quot;enabled&quot;</span><span class="p">]:</span>
        <span class="n">batch_sizes</span> <span class="o">=</span> <span class="n">conf</span><span class="p">[</span><span class="s2">&quot;batch_scaling&quot;</span><span class="p">][</span><span class="s2">&quot;sizes&quot;</span><span class="p">]</span>
        <span class="n">batch_train_losses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">batch_test_losses</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">batch_size</span> <span class="ow">in</span> <span class="n">batch_sizes</span><span class="p">:</span>
            <span class="n">train_loss</span><span class="p">,</span> <span class="n">test_loss</span> <span class="o">=</span> <span class="n">load_losses</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">surr_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_batchsize_</span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">batch_train_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">train_loss</span><span class="p">)</span>
            <span class="n">batch_test_losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_loss</span><span class="p">)</span>
        <span class="n">plot_losses</span><span class="p">(</span>
            <span class="nb">tuple</span><span class="p">(</span><span class="n">batch_train_losses</span><span class="p">),</span>
            <span class="nb">tuple</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Batch Size </span><span class="si">{</span><span class="n">batch_size</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">batch_size</span> <span class="ow">in</span> <span class="n">batch_sizes</span><span class="p">),</span>
            <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Batch Size Losses&quot;</span><span class="p">,</span>
            <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">conf</span><span class="o">=</span><span class="n">conf</span><span class="p">,</span>
            <span class="n">surr_name</span><span class="o">=</span><span class="n">surr_name</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;batchsize&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="plot_error_distribution_per_chemical">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_error_distribution_per_chemical">[docs]</a>
<span class="k">def</span> <span class="nf">plot_error_distribution_per_chemical</span><span class="p">(</span>
    <span class="n">surr_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">conf</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">errors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">chemical_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_chemicals</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the distribution of errors for each chemical as a smoothed histogram plot.</span>

<span class="sd">    Args:</span>
<span class="sd">        surr_name (str): The name of the surrogate model.</span>
<span class="sd">        conf (dict): The configuration dictionary.</span>
<span class="sd">        errors (np.ndarray): Errors array of shape [num_samples, num_timesteps, num_chemicals].</span>
<span class="sd">        chemical_names (list, optional): List of chemical names for labeling the lines.</span>
<span class="sd">        num_chemicals (int, optional): Number of chemicals to plot. Default is 10.</span>
<span class="sd">        save (bool, optional): Whether to save the plot as a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Reshape errors to combine samples and timesteps</span>
    <span class="n">total_chemicals</span> <span class="o">=</span> <span class="n">errors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">errors</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">total_chemicals</span><span class="p">)</span>
    <span class="n">n_errors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># Cap the number of chemicals to plot at 50</span>
    <span class="n">num_chemicals</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">num_chemicals</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[:,</span> <span class="p">:</span><span class="n">num_chemicals</span><span class="p">]</span>
    <span class="n">chemical_names</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">chemical_names</span><span class="p">[:</span><span class="n">num_chemicals</span><span class="p">]</span> <span class="k">if</span> <span class="n">chemical_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>

    <span class="c1"># Split the chemicals into groups of 10</span>
    <span class="n">chemicals_per_plot</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">num_plots</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">num_chemicals</span> <span class="o">/</span> <span class="n">chemicals_per_plot</span><span class="p">))</span>

    <span class="c1"># Initialize list to hold log-transformed non-zero errors and count zeros</span>
    <span class="n">log_errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">zero_counts</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Transform error magnitudes to log-space and filter out zeros</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_chemicals</span><span class="p">):</span>
        <span class="n">chemical_errors</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">chemical_errors</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error values contain NaNs.&quot;</span><span class="p">)</span>
        <span class="n">non_zero_chemical_errors</span> <span class="o">=</span> <span class="n">chemical_errors</span><span class="p">[</span><span class="n">chemical_errors</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">log_errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">non_zero_chemical_errors</span><span class="p">))</span>
        <span class="n">zero_counts</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">chemical_errors</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Calculate the 1st and 99th percentiles in the log-space</span>
    <span class="n">min_percentiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">log_errors</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">max_percentiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="mi">99</span><span class="p">)</span> <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">log_errors</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">global_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">min_percentiles</span><span class="p">)</span>
    <span class="n">global_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">max_percentiles</span><span class="p">)</span>

    <span class="c1"># Set up the x-axis range to nearest whole numbers in log-space</span>
    <span class="n">x_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">global_min</span><span class="p">)</span>
    <span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">global_max</span><span class="p">)</span>

    <span class="c1"># Create subplots with shared x-axis</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">num_plots</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">num_plots</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">num_plots</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">axes</span><span class="p">]</span>  <span class="c1"># Ensure axes is iterable even if there&#39;s only one plot</span>

    <span class="c1"># colors = plt.cm.magma(np.linspace(0, 0.9, chemicals_per_plot))</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">get_custom_palette</span><span class="p">(</span><span class="n">chemicals_per_plot</span><span class="p">)</span>

    <span class="c1"># Define the x-axis range for plotting</span>
    <span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">plot_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_plots</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">plot_idx</span><span class="p">]</span>
        <span class="n">start_idx</span> <span class="o">=</span> <span class="n">plot_idx</span> <span class="o">*</span> <span class="n">chemicals_per_plot</span>
        <span class="n">end_idx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">plot_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">chemicals_per_plot</span><span class="p">,</span> <span class="n">num_chemicals</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_idx</span><span class="p">,</span> <span class="n">end_idx</span><span class="p">):</span>
            <span class="c1"># Compute histogram in log-space</span>
            <span class="n">hist</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">log_errors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Smooth the histogram with a Gaussian filter</span>
            <span class="n">smoothed_hist</span> <span class="o">=</span> <span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># Plot the smoothed histogram</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="mi">10</span> <span class="o">**</span> <span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">smoothed_hist</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="p">(</span>
                    <span class="n">chemical_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">chemical_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">chemical_names</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">i</span>
                    <span class="k">else</span> <span class="kc">None</span>
                <span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">chemicals_per_plot</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Density (PDF)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">chemical_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>  <span class="c1"># Log scale for error magnitudes</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">x_min</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">x_max</span><span class="p">)</span>  <span class="c1"># Set x-axis range based on log-space calculations</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Magnitude of Error&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Error Distribution per Chemical (Test Samples: </span><span class="si">{</span><span class="n">n_errors</span><span class="si">}</span><span class="s2">, Excluded zeros: </span><span class="si">{</span><span class="n">zero_counts</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.97</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">conf</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="s2">&quot;accuracy_error_per_quantity.png&quot;</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">surr_name</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<span class="c1"># Comparative plots from here on!</span>


<div class="viewcode-block" id="plot_losses">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_losses">[docs]</a>
<span class="k">def</span> <span class="nf">plot_losses</span><span class="p">(</span>
    <span class="n">loss_histories</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">labels</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;Losses&quot;</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">conf</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">surr_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;main&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the loss trajectories for the training of multiple models.</span>

<span class="sd">    :param loss_histories: List of loss history arrays.</span>
<span class="sd">    :param labels: List of labels for each loss history.</span>
<span class="sd">    :param title: Title of the plot.</span>
<span class="sd">    :param save: Whether to save the plot as an image file.</span>
<span class="sd">    :param conf: The configuration dictionary.</span>
<span class="sd">    :param surr_name: The name of the surrogate model.</span>
<span class="sd">    :param mode: The mode of the training.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">magma</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">loss_histories</span><span class="p">)))</span>

    <span class="c1"># Create the figure</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">loss_plotted</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">loss</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">loss_histories</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">loss</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">loss</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)])</span>
            <span class="n">loss_plotted</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epoch&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">loss_histories</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Loss&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">loss_plotted</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="mf">0.5</span><span class="p">,</span>
            <span class="mf">0.5</span><span class="p">,</span>
            <span class="s2">&quot;No losses available&quot;</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">conf</span> <span class="ow">and</span> <span class="n">surr_name</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="s2">&quot;losses_&quot;</span> <span class="o">+</span> <span class="n">mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">surr_name</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="plot_loss_comparison">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_loss_comparison">[docs]</a>
<span class="k">def</span> <span class="nf">plot_loss_comparison</span><span class="p">(</span>
    <span class="n">train_losses</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">test_losses</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">labels</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the training and test losses for different surrogate models.</span>

<span class="sd">    Args:</span>
<span class="sd">        train_losses (tuple): Tuple of training loss arrays for each surrogate model.</span>
<span class="sd">        test_losses (tuple): Tuple of test loss arrays for each surrogate model.</span>
<span class="sd">        labels (tuple): Tuple of labels for each surrogate model.</span>
<span class="sd">        config (dict): Configuration dictionary.</span>
<span class="sd">        save (bool): Whether to save the plot.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_losses</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">train_loss</span><span class="p">,</span> <span class="n">test_loss</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
        <span class="nb">zip</span><span class="p">(</span><span class="n">train_losses</span><span class="p">,</span> <span class="n">test_losses</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_loss</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> Train Loss&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_loss</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> Test Loss&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">max_epochs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span> <span class="k">for</span> <span class="n">loss</span> <span class="ow">in</span> <span class="n">train_losses</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epoch&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_epochs</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Loss&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Comparison of Training and Test Losses&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">config</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="s2">&quot;losses_main_model.png&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="plot_MAE_comparison">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_MAE_comparison">[docs]</a>
<span class="k">def</span> <span class="nf">plot_MAE_comparison</span><span class="p">(</span>
    <span class="n">MAEs</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">labels</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the MAE for different surrogate models.</span>

<span class="sd">    Args:</span>
<span class="sd">        MAE (tuple): Tuple of accuracy arrays for each surrogate model.</span>
<span class="sd">        labels (tuple): Tuple of labels for each surrogate model.</span>
<span class="sd">        config (dict): Configuration dictionary.</span>
<span class="sd">        save (bool): Whether to save the plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">MAEs</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">MAEs</span><span class="p">,</span> <span class="n">labels</span><span class="p">)):</span>
        <span class="c1"># Modify the label to include the final MAE</span>
        <span class="n">final_MAE</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> (final MAE: </span><span class="si">{</span><span class="n">final_MAE</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Epoch&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;MAE&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Comparison of Model Mean Absolute Errors&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">config</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="s2">&quot;MAE_main_model.png&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="plot_MAE_comparison_train_duration">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_MAE_comparison_train_duration">[docs]</a>
<span class="k">def</span> <span class="nf">plot_MAE_comparison_train_duration</span><span class="p">(</span>
    <span class="n">MAEs</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">labels</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">train_durations</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
    <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the MAE for different surrogate models.</span>

<span class="sd">    Args:</span>
<span class="sd">        MAE (tuple): Tuple of accuracy arrays for each surrogate model.</span>
<span class="sd">        labels (tuple): Tuple of labels for each surrogate model.</span>
<span class="sd">        config (dict): Configuration dictionary.</span>
<span class="sd">        save (bool): Whether to save the plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">MAEs</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">accuracy</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">train_duration</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
        <span class="nb">zip</span><span class="p">(</span><span class="n">MAEs</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">train_durations</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="n">epoch_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">train_duration</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">accuracy</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epoch_times</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">train_durations</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;MAE&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Comparison of Model Mean Absolute Error over Training Duration&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">config</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="s2">&quot;losses_MAE_main_model.png&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="plot_relative_errors">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_relative_errors">[docs]</a>
<span class="k">def</span> <span class="nf">plot_relative_errors</span><span class="p">(</span>
    <span class="n">mean_errors</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">median_errors</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">timesteps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the relative errors over time for different surrogate models.</span>

<span class="sd">    Args:</span>
<span class="sd">        mean_errors (dict): dictionary containing the mean relative errors for each surrogate model.</span>
<span class="sd">        median_errors (dict): dictionary containing the median relative errors for each surrogate model.</span>
<span class="sd">        timesteps (np.ndarray): Array of timesteps.</span>
<span class="sd">        config (dict): Configuration dictionary.</span>
<span class="sd">        save (bool): Whether to save the plot.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mean_errors</span><span class="p">)))</span>
    <span class="n">linestyles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">surrogate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mean_errors</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mean_errors</span><span class="p">[</span><span class="n">surrogate</span><span class="p">])</span>
        <span class="n">mean_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">surrogate</span><span class="si">}</span><span class="s2"> Mean = </span><span class="si">{</span><span class="n">mean</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> %&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">timesteps</span><span class="p">,</span>
            <span class="n">mean_errors</span><span class="p">[</span><span class="n">surrogate</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="n">mean_label</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">median_errors</span><span class="p">[</span><span class="n">surrogate</span><span class="p">])</span>
        <span class="n">median_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">surrogate</span><span class="si">}</span><span class="s2"> Median = </span><span class="si">{</span><span class="n">median</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> %&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">timesteps</span><span class="p">,</span>
            <span class="n">median_errors</span><span class="p">[</span><span class="n">surrogate</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="n">median_label</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">timesteps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">timesteps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Relative Error&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Comparison of Relative Errors Over Time&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="c1"># plt.grid(True)</span>

    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">config</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="s2">&quot;accuracy_rel_errors_time_models.png&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="plot_uncertainty_over_time_comparison">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_uncertainty_over_time_comparison">[docs]</a>
<span class="k">def</span> <span class="nf">plot_uncertainty_over_time_comparison</span><span class="p">(</span>
    <span class="n">uncertainties</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">absolute_errors</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">timesteps</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the uncertainty over time for different surrogate models.</span>

<span class="sd">    Args:</span>
<span class="sd">        uncertainties (dict): Dictionary containing the uncertainties for each surrogate model.</span>
<span class="sd">        absolute_errors (dict): Dictionary containing the absolute errors for each surrogate model.</span>
<span class="sd">        timesteps (np.ndarray): Array of timesteps.</span>
<span class="sd">        config (dict): Configuration dictionary.</span>
<span class="sd">        save (bool): Whether to save the plot.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">uncertainties</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">surrogate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">uncertainties</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">avg_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">uncertainties</span><span class="p">[</span><span class="n">surrogate</span><span class="p">])</span>
        <span class="n">uq_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">surrogate</span><span class="si">}</span><span class="s2"> uncertainty (mean: </span><span class="si">{</span><span class="n">avg_uncertainty</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">timesteps</span><span class="p">,</span>
            <span class="n">uncertainties</span><span class="p">[</span><span class="n">surrogate</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="n">uq_label</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">abs_errors</span> <span class="o">=</span> <span class="n">absolute_errors</span><span class="p">[</span><span class="n">surrogate</span><span class="p">]</span>
        <span class="n">abs_errors_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">abs_errors</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">abs_error_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">abs_errors_time</span><span class="p">)</span>
        <span class="n">err_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">surrogate</span><span class="si">}</span><span class="s2"> abs. error (mean: </span><span class="si">{</span><span class="n">abs_error_avg</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">timesteps</span><span class="p">,</span>
            <span class="n">abs_errors_time</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">err_label</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">timesteps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">timesteps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Uncertainty/Absolute Error&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Comparison of Predictive Uncertainty Over Time&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">config</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="s2">&quot;uncertainty_over_time.png&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="inference_time_bar_plot">
<a class="viewcode-back" href="../../benchmark.html#benchmark.inference_time_bar_plot">[docs]</a>
<span class="k">def</span> <span class="nf">inference_time_bar_plot</span><span class="p">(</span>
    <span class="n">surrogates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">means</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">stds</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the mean inference time with standard deviation for different surrogate models.</span>

<span class="sd">    Args:</span>
<span class="sd">        surrogates (List[str]): List of surrogate model names.</span>
<span class="sd">        means (List[float]): List of mean inference times for each surrogate model.</span>
<span class="sd">        stds (List[float]): List of standard deviation of inference times for each surrogate model.</span>
<span class="sd">        config (dict): Configuration dictionary.</span>
<span class="sd">        save (bool, optional): Whether to save the plot. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create the bar plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">surrogates</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">surrogates</span><span class="p">,</span> <span class="n">means</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">stds</span><span class="p">,</span> <span class="n">capsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">ecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Calculate the upper y-limit to provide space for text</span>
    <span class="n">max_bar</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">stds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">)))</span>
    <span class="n">min_bar</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">means</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">stds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">means</span><span class="p">)))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">min_bar</span> <span class="o">*</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">max_bar</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># Set limits with some padding</span>

    <span class="c1"># Add inference time as text to the bars using the format_time function</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">means</span><span class="p">,</span> <span class="n">stds</span><span class="p">)):</span>
        <span class="n">formatted_time</span> <span class="o">=</span> <span class="n">format_time</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="n">i</span><span class="p">,</span>
            <span class="n">mean</span> <span class="o">+</span> <span class="n">std</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">,</span>  <span class="c1"># Position the text above the bar</span>
            <span class="n">formatted_time</span><span class="p">,</span>
            <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Surrogate Model&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Mean Inference Time per Run&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Comparison of Mean Inference Time with Standard Deviation&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="s2">&quot;timing_inference.png&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="plot_generalization_error_comparison">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_generalization_error_comparison">[docs]</a>
<span class="k">def</span> <span class="nf">plot_generalization_error_comparison</span><span class="p">(</span>
    <span class="n">surrogates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">metrics_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">],</span>
    <span class="n">model_errors_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">],</span>
    <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">xlog</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the generalization errors of different surrogate models.</span>

<span class="sd">    Args:</span>
<span class="sd">        surrogates (list): List of surrogate model names.</span>
<span class="sd">        metrics_list (list[np.array]): List of numpy arrays containing the metrics for each surrogate model.</span>
<span class="sd">        model_errors_list (list[np.array]): List of numpy arrays containing the errors for each surrogate model.</span>
<span class="sd">        xlabel (str): Label for the x-axis.</span>
<span class="sd">        filename (str): Filename to save the plot.</span>
<span class="sd">        config (dict): Configuration dictionary.</span>
<span class="sd">        save (bool): Whether to save the plot.</span>
<span class="sd">        xlog (bool): Whether to use a log scale for the x-axis.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">surrogates</span><span class="p">)))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">surrogate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">surrogates</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">metrics_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">model_errors_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">surrogate</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="c1"># Add thin lines of the same color to show the trend</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">metrics_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">model_errors_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xlog</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Mean Absolute Error&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Comparison of </span><span class="si">{</span><span class="n">xlabel</span><span class="si">}</span><span class="s2"> Errors&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="plot_error_correlation_heatmap">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_error_correlation_heatmap">[docs]</a>
<span class="k">def</span> <span class="nf">plot_error_correlation_heatmap</span><span class="p">(</span>
    <span class="n">surr_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">conf</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">preds_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">errors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">average_correlation</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">threshold_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-2</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the correlation between predictive uncertainty and prediction errors using a heatmap.</span>

<span class="sd">    Args:</span>
<span class="sd">        surr_name (str): The name of the surrogate model.</span>
<span class="sd">        conf (dict): The configuration dictionary.</span>
<span class="sd">        preds_std (np.ndarray): Standard deviation of predictions from the ensemble of models.</span>
<span class="sd">        errors (np.ndarray): Prediction errors.</span>
<span class="sd">        average_correlation (float): The average correlation between gradients and prediction errors (pearson correlation).</span>
<span class="sd">        save (bool, optional): Whether to save the plot as a file.</span>
<span class="sd">        threshold_factor (float, optional): Fraction of max value below which cells are set to 0. Default is 0.001.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">heatmap</span><span class="p">,</span> <span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span>
        <span class="n">preds_std</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">errors</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span>
    <span class="p">)</span>

    <span class="c1"># Apply threshold to create a mask and determine new axis limits</span>
    <span class="n">max_value</span> <span class="o">=</span> <span class="n">heatmap</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold_factor</span> <span class="o">*</span> <span class="n">max_value</span>

    <span class="c1"># Mask to find the densest part for axis limits, but don&#39;t alter heatmap values</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">heatmap</span> <span class="o">&gt;=</span> <span class="n">threshold</span>
    <span class="n">non_zero_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
    <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">xedges</span><span class="p">[</span><span class="n">non_zero_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()],</span>
        <span class="n">xedges</span><span class="p">[</span><span class="n">non_zero_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">yedges</span><span class="p">[</span><span class="n">non_zero_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()],</span>
        <span class="n">yedges</span><span class="p">[</span><span class="n">non_zero_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Find the common range to use for both axes to ensure aspect ratio</span>
    <span class="n">axis_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">y_min</span><span class="p">)</span>
    <span class="n">axis_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)</span>

    <span class="c1"># Re-bin the data using the new axis limits</span>
    <span class="n">heatmap</span><span class="p">,</span> <span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span>
        <span class="n">preds_std</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
        <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="nb">range</span><span class="o">=</span><span class="p">[[</span><span class="n">axis_min</span><span class="p">,</span> <span class="n">axis_max</span><span class="p">],</span> <span class="p">[</span><span class="n">axis_min</span><span class="p">,</span> <span class="n">axis_max</span><span class="p">]],</span>
    <span class="p">)</span>

    <span class="c1"># Set all fields with 0 counts to 1 count for log scale plotting</span>
    <span class="n">heatmap</span><span class="p">[</span><span class="n">heatmap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">heatmap</span><span class="o">.</span><span class="n">T</span><span class="p">),</span>  <span class="c1"># Log scale for better visualization</span>
        <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span>
        <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">axis_min</span><span class="p">,</span> <span class="n">axis_max</span><span class="p">,</span> <span class="n">axis_min</span><span class="p">,</span> <span class="n">axis_max</span><span class="p">],</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;inferno&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\log_</span><span class="si">{10}</span><span class="s2">$(Counts)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Predictive Uncertainty&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Prediction Error&quot;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Correlation between Predictive Uncertainty and Prediction Errors (Heatmap)</span><span class="se">\n</span><span class="s2">Average Correlation: </span><span class="si">{</span><span class="n">average_correlation</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="c1"># Add diagonal line</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span><span class="n">axis_min</span><span class="p">,</span> <span class="n">axis_max</span><span class="p">],</span>
        <span class="p">[</span><span class="n">axis_min</span><span class="p">,</span> <span class="n">axis_max</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">conf</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="s2">&quot;uncertainty_errors_correlation.png&quot;</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">surr_name</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">max_value</span><span class="p">,</span> <span class="n">axis_max</span></div>



<div class="viewcode-block" id="plot_dynamic_correlation_heatmap">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_dynamic_correlation_heatmap">[docs]</a>
<span class="k">def</span> <span class="nf">plot_dynamic_correlation_heatmap</span><span class="p">(</span>
    <span class="n">surr_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">conf</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">preds_std</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">errors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">average_correlation</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">threshold_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span>
    <span class="n">xcut_percent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3e-3</span><span class="p">,</span>  <span class="c1"># Default to keep 95% of the total counts in the heatmap</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the correlation between predictive uncertainty and prediction errors using a heatmap.</span>

<span class="sd">    Args:</span>
<span class="sd">        surr_name (str): The name of the surrogate model.</span>
<span class="sd">        conf (dict): The configuration dictionary.</span>
<span class="sd">        preds_std (np.ndarray): Standard deviation of predictions from the ensemble of models.</span>
<span class="sd">        errors (np.ndarray): Prediction errors.</span>
<span class="sd">        average_correlation (float): The average correlation between gradients and prediction errors (pearson correlation).</span>
<span class="sd">        save (bool, optional): Whether to save the plot as a file.</span>
<span class="sd">        threshold_factor (float, optional): Fraction of max value below which cells are set to 0. Default is 5e-5.</span>
<span class="sd">        cutoff_percent (float, optional): The percentage of total counts to include in the heatmap. Default is 0.95.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">heatmap</span><span class="p">,</span> <span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span>
        <span class="n">preds_std</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">errors</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">100</span>
    <span class="p">)</span>

    <span class="c1"># Apply threshold to create a mask and determine new axis limits</span>
    <span class="n">max_value</span> <span class="o">=</span> <span class="n">heatmap</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold_factor</span> <span class="o">*</span> <span class="n">max_value</span>

    <span class="c1"># Mask to find the densest part for y-axis limits</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">heatmap</span> <span class="o">&gt;=</span> <span class="n">threshold</span>
    <span class="n">non_zero_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
    <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">yedges</span><span class="p">[</span><span class="n">non_zero_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()],</span>
        <span class="n">yedges</span><span class="p">[</span><span class="n">non_zero_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Calculate the cumulative counts along the x-axis</span>
    <span class="n">cumulative_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">heatmap</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">total_counts</span> <span class="o">=</span> <span class="n">cumulative_counts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">cutoff_percent</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">xcut_percent</span>
    <span class="n">cutoff_count</span> <span class="o">=</span> <span class="n">cutoff_percent</span> <span class="o">*</span> <span class="n">total_counts</span>

    <span class="c1"># Find the x_max where the cumulative count exceeds cutoff_count</span>
    <span class="n">x_max_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">cumulative_counts</span><span class="p">,</span> <span class="n">cutoff_count</span><span class="p">)</span>
    <span class="n">x_max</span> <span class="o">=</span> <span class="n">xedges</span><span class="p">[</span><span class="n">x_max_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># +1 to include the bin</span>

    <span class="n">x_min</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Normalized gradients typically start from 0</span>

    <span class="c1"># Re-bin the data using the new axis limits</span>
    <span class="n">heatmap</span><span class="p">,</span> <span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span>
        <span class="n">preds_std</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
        <span class="n">errors</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
        <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="nb">range</span><span class="o">=</span><span class="p">[[</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">],</span> <span class="p">[</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">]],</span>
    <span class="p">)</span>

    <span class="c1"># Set all fields with 0 counts to 1 count for log scale plotting</span>
    <span class="n">heatmap</span><span class="p">[</span><span class="n">heatmap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">heatmap</span><span class="o">.</span><span class="n">T</span><span class="p">),</span>  <span class="c1"># Log scale for better visualization</span>
        <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span>
        <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
        <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">],</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;inferno&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\log_</span><span class="si">{10}</span><span class="s2">$(Counts)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Absolute Gradient (Normalized)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Absolute Prediction Error&quot;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Correlation between Gradients and Prediction Errors (Heatmap)</span><span class="se">\n</span><span class="s2">Average Correlation: </span><span class="si">{</span><span class="n">average_correlation</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">conf</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="s2">&quot;gradient_error_heatmap.png&quot;</span><span class="p">,</span> <span class="n">conf</span><span class="p">,</span> <span class="n">surr_name</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">max_value</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">y_max</span></div>



<div class="viewcode-block" id="plot_error_distribution_comparative">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_error_distribution_comparative">[docs]</a>
<span class="k">def</span> <span class="nf">plot_error_distribution_comparative</span><span class="p">(</span>
    <span class="n">errors</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">conf</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot the comparative distribution of errors for each surrogate model as a smoothed histogram plot.</span>

<span class="sd">    Args:</span>
<span class="sd">        conf (dict): The configuration dictionary.</span>
<span class="sd">        errors (dict): Dictionary containing numpy arrays of shape [num_samples, num_timesteps, num_chemicals] for each model.</span>
<span class="sd">        save (bool, optional): Whether to save the plot as a file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Number of models</span>
    <span class="n">model_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">num_models</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_names</span><span class="p">)</span>

    <span class="c1"># Initialize list to hold log-transformed non-zero errors and count zeros</span>
    <span class="n">log_errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">mean_errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">median_errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">zero_counts</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Transform error magnitudes to log-space and filter out zeros for each model</span>
    <span class="k">for</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="n">model_names</span><span class="p">:</span>
        <span class="n">model_errors</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">mean_errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">model_errors</span><span class="p">))</span>
        <span class="n">median_errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">model_errors</span><span class="p">))</span>
        <span class="n">non_zero_model_errors</span> <span class="o">=</span> <span class="n">model_errors</span><span class="p">[</span><span class="n">model_errors</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">log_errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">non_zero_model_errors</span><span class="p">))</span>
        <span class="n">zero_counts</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">model_errors</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Calculate the 1st and 99th percentiles in the log-space</span>
    <span class="n">min_percentiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">log_errors</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">max_percentiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="mi">98</span><span class="p">)</span> <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">log_errors</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">global_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">min_percentiles</span><span class="p">)</span>
    <span class="n">global_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">max_percentiles</span><span class="p">)</span>

    <span class="c1"># Set up the x-axis range to nearest whole numbers in log-space</span>
    <span class="n">x_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">global_min</span><span class="p">)</span>
    <span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">global_max</span><span class="p">)</span>

    <span class="c1"># Set up the plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">num_models</span><span class="p">))</span>

    <span class="c1"># Define the x-axis range for plotting</span>
    <span class="n">x_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_names</span><span class="p">):</span>
        <span class="c1"># Compute histogram in log-space</span>
        <span class="n">hist</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">log_errors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">x_vals</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Smooth the histogram with a Gaussian filter</span>
        <span class="n">smoothed_hist</span> <span class="o">=</span> <span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Plot the smoothed histogram</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="mi">10</span> <span class="o">**</span> <span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">smoothed_hist</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># Plot the average error as a vertical line</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">mean_errors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> mean = </span><span class="si">{</span><span class="n">mean_errors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">median_errors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2"> median = </span><span class="si">{</span><span class="n">median_errors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>  <span class="c1"># Log scale for error magnitudes</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">x_min</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">x_max</span><span class="p">)</span>  <span class="c1"># Set x-axis range based on log-space calculations</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Magnitude of Error&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Density (PDF)&quot;</span><span class="p">)</span>
    <span class="n">num_test_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="n">model_names</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="o">*</span> <span class="n">num_models</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Error Distribution per Model (Test Samples: </span><span class="si">{</span><span class="n">num_test_samples</span><span class="si">}</span><span class="s2">, Excluded zeros: </span><span class="si">{</span><span class="n">zero_counts</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">conf</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">plt</span><span class="p">,</span> <span class="s2">&quot;accuracy_error_distributions.png&quot;</span><span class="p">,</span> <span class="n">conf</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="plot_comparative_error_correlation_heatmaps">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_comparative_error_correlation_heatmaps">[docs]</a>
<span class="k">def</span> <span class="nf">plot_comparative_error_correlation_heatmaps</span><span class="p">(</span>
    <span class="n">preds_std</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">errors</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">avg_correlations</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">axis_max</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">max_count</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot comparative heatmaps of correlation between predictive uncertainty and prediction errors</span>
<span class="sd">    for multiple surrogate models.</span>

<span class="sd">    Args:</span>
<span class="sd">        preds_std (dict[str, np.ndarray]): Dictionary of standard deviation of predictions from the ensemble of models.</span>
<span class="sd">        errors (dict[str, np.ndarray]): Dictionary of prediction errors.</span>
<span class="sd">        avg_correlations (dict[str, float]): Dictionary of average correlations between gradients and prediction errors.</span>
<span class="sd">        axis_max (dict[str, float]): Dictionary of maximum values for axis scaling across models.</span>
<span class="sd">        max_count (dict[str, float]): Dictionary of maximum count values for heatmap normalization across models.</span>
<span class="sd">        config (dict): Configuration dictionary.</span>
<span class="sd">        save (bool, optional): Whether to save the plot. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Number of models</span>
    <span class="n">model_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">preds_std</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">num_models</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_names</span><span class="p">)</span>

    <span class="c1"># Determine the global maximum value for axis scaling</span>
    <span class="n">global_axis_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">axis_max</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="c1"># Determine global max for heatmap normalization</span>
    <span class="n">global_max_count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_count</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="c1"># Create subplots, one row per model</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="n">num_models</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">num_models</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Adjust layout for shared colorbar</span>
    <span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.92</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">])</span>  <span class="c1"># Position for the colorbar</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_names</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">preds_std_model</span> <span class="o">=</span> <span class="n">preds_std</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">errors_model</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">avg_corr</span> <span class="o">=</span> <span class="n">avg_correlations</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span>

        <span class="c1"># Compute 2D histogram (heatmap)</span>
        <span class="n">heatmap</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span>
            <span class="n">preds_std_model</span><span class="p">,</span>
            <span class="n">errors_model</span><span class="p">,</span>
            <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="nb">range</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="n">global_axis_max</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">global_axis_max</span><span class="p">]],</span>
        <span class="p">)</span>

        <span class="c1"># Set all fields with 0 counts to 1 count for log scale plotting</span>
        <span class="n">heatmap</span><span class="p">[</span><span class="n">heatmap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Plot heatmap</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">heatmap</span><span class="o">.</span><span class="n">T</span><span class="p">),</span>
            <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span>
            <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
            <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">global_axis_max</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">global_axis_max</span><span class="p">],</span>
            <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;inferno&quot;</span><span class="p">,</span>
            <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">global_max_count</span><span class="p">),</span>  <span class="c1"># Normalize across all models</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Predictive Uncertainty&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Prediction Error&quot;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">Avg Correlation: </span><span class="si">{</span><span class="n">avg_corr</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Add diagonal line</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">global_axis_max</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">global_axis_max</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.92</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="c1"># Shared colorbar</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\log_</span><span class="si">{10}</span><span class="s2">$(Counts)&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Comparative Error Correlation Heatmaps Across Models&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.98</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="s2">&quot;uncertainty_error_corr_comparison.png&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="plot_comparative_dynamic_correlation_heatmaps">
<a class="viewcode-back" href="../../benchmark.html#benchmark.plot_comparative_dynamic_correlation_heatmaps">[docs]</a>
<span class="k">def</span> <span class="nf">plot_comparative_dynamic_correlation_heatmaps</span><span class="p">(</span>
    <span class="n">gradients</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">errors</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">avg_correlations</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">max_grad</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">max_err</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">max_count</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
    <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot comparative heatmaps of correlation between gradient and prediction errors</span>
<span class="sd">    for multiple surrogate models.</span>

<span class="sd">    Args:</span>
<span class="sd">        gradients (dict[str, np.ndarray]): Dictionary of gradients from the ensemble of models.</span>
<span class="sd">        errors (dict[str, np.ndarray]): Dictionary of prediction errors.</span>
<span class="sd">        avg_correlations (dict[str, float]): Dictionary of average correlations between gradients and prediction errors.</span>
<span class="sd">        max_grad (dict[str, float]): Dictionary of maximum gradient values for axis scaling across models.</span>
<span class="sd">        max_err (dict[str, float]): Dictionary of maximum error values for axis scaling across models.</span>
<span class="sd">        max_count (dict[str, float]): Dictionary of maximum count values for heatmap normalization across models.</span>
<span class="sd">        config (dict): Configuration dictionary.</span>
<span class="sd">        save (bool, optional): Whether to save the plot. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Number of models</span>
    <span class="n">model_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gradients</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">num_models</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_names</span><span class="p">)</span>

    <span class="c1"># Determine global max for axis scaling</span>
    <span class="n">global_x_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_grad</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
    <span class="n">global_y_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_err</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="c1"># Determine global max for heatmap normalization</span>
    <span class="n">global_max_count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_count</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="c1"># Create subplots, one row per model</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="n">num_models</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">num_models</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="c1"># Adjust layout for shared colorbar</span>
    <span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.92</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_names</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">grad_model</span> <span class="o">=</span> <span class="n">gradients</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">errors_model</span> <span class="o">=</span> <span class="n">errors</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">avg_corr</span> <span class="o">=</span> <span class="n">avg_correlations</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span>

        <span class="c1"># Re-bin the data using the global axis limits</span>
        <span class="n">heatmap</span><span class="p">,</span> <span class="n">xedges</span><span class="p">,</span> <span class="n">yedges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span>
            <span class="n">grad_model</span><span class="p">,</span>
            <span class="n">errors_model</span><span class="p">,</span>
            <span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="nb">range</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="n">global_x_max</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">global_y_max</span><span class="p">]],</span>
        <span class="p">)</span>

        <span class="c1"># Set all fields with 0 counts to 1 count for log scale plotting</span>
        <span class="n">heatmap</span><span class="p">[</span><span class="n">heatmap</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Plot heatmap</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">heatmap</span><span class="o">.</span><span class="n">T</span><span class="p">),</span>
            <span class="n">origin</span><span class="o">=</span><span class="s2">&quot;lower&quot;</span><span class="p">,</span>
            <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
            <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">global_x_max</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">global_y_max</span><span class="p">],</span>
            <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;inferno&quot;</span><span class="p">,</span>
            <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">global_max_count</span><span class="p">),</span>  <span class="c1"># Normalize across all models</span>
        <span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Absolute Gradient (Normalized)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Absolute Prediction Error&quot;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="se">\n</span><span class="s2">Avg Correlation: </span><span class="si">{</span><span class="n">avg_corr</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.92</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="c1"># Shared colorbar</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$\log_</span><span class="si">{10}</span><span class="s2">$(Counts)&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
        <span class="s2">&quot;Comparative Gradient vs. Prediction Error Heatmaps Across Models&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.98</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="s2">&quot;gradients_error_corr_comparison.png&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="get_custom_palette">
<a class="viewcode-back" href="../../benchmark.html#benchmark.get_custom_palette">[docs]</a>
<span class="k">def</span> <span class="nf">get_custom_palette</span><span class="p">(</span><span class="n">num_colors</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns a list of colors sampled from a custom color palette.</span>

<span class="sd">    Args:</span>
<span class="sd">        num_colors (int): The number of colors needed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of RGBA color tuples.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Define your custom color palette as a list of hex color codes</span>
    <span class="c1"># custom_palette = [</span>
    <span class="c1">#     &quot;#1f77b4&quot;,  # blue</span>
    <span class="c1">#     &quot;#ff7f0e&quot;,  # orange</span>
    <span class="c1">#     &quot;#2ca02c&quot;,  # green</span>
    <span class="c1">#     &quot;#d62728&quot;,  # red</span>
    <span class="c1">#     &quot;#9467bd&quot;,  # purple</span>
    <span class="c1">#     &quot;#8c564b&quot;,  # brown</span>
    <span class="c1">#     &quot;#e377c2&quot;,  # pink</span>
    <span class="c1">#     &quot;#7f7f7f&quot;,  # gray</span>
    <span class="c1">#     &quot;#bcbd22&quot;,  # yellow</span>
    <span class="c1">#     &quot;#17becf&quot;,  # teal</span>
    <span class="c1"># ]</span>

    <span class="n">custom_palette</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;#10002B&quot;</span><span class="p">,</span>  <span class="c1"># Darkest violet</span>
        <span class="s2">&quot;#3A1A5A&quot;</span><span class="p">,</span>  <span class="c1"># Dark purple (slightly brighter)</span>
        <span class="s2">&quot;#6A1C75&quot;</span><span class="p">,</span>  <span class="c1"># Deep magenta (slightly brighter)</span>
        <span class="s2">&quot;#8A3065&quot;</span><span class="p">,</span>  <span class="c1"># Magenta with a hint of red</span>
        <span class="s2">&quot;#B73779&quot;</span><span class="p">,</span>  <span class="c1"># Deep reddish-pink</span>
        <span class="s2">&quot;#DA5F4D&quot;</span><span class="p">,</span>  <span class="c1"># Dark red-orange</span>
        <span class="s2">&quot;#F48842&quot;</span><span class="p">,</span>  <span class="c1"># Bright orange</span>
        <span class="s2">&quot;#FBC200&quot;</span><span class="p">,</span>  <span class="c1"># Yellow-orange (slightly more yellow)</span>
        <span class="s2">&quot;#C0CD32&quot;</span><span class="p">,</span>  <span class="c1"># Yellow-green (more yellowish)</span>
        <span class="s2">&quot;#D2B48C&quot;</span><span class="p">,</span>  <span class="c1"># Tan (brownish)</span>
    <span class="p">]</span>

    <span class="c1"># Create a custom colormap from the palette</span>
    <span class="n">custom_cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">custom_palette</span><span class="p">)</span>

    <span class="c1"># Sample colors from your custom colormap</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">custom_cmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_colors</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">colors</span></div>



<div class="viewcode-block" id="int_ext_sparse">
<a class="viewcode-back" href="../../benchmark.html#benchmark.int_ext_sparse">[docs]</a>
<span class="k">def</span> <span class="nf">int_ext_sparse</span><span class="p">(</span><span class="n">all_metrics</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to make one comparative plot of the interpolation, extrapolation, and sparse training errors.</span>

<span class="sd">    Args:</span>
<span class="sd">        all_metrics (dict): dictionary containing the benchmark metrics for each surrogate model.</span>
<span class="sd">        config (dict): Configuration dictionary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">surrogates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">all_metrics</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="c1"># Prepare the data for each modality</span>
    <span class="n">interpolation_metrics_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">interpolation_errors_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">extrapolation_metrics_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">extrapolation_errors_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">sparse_metrics_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sparse_errors_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">surrogate</span> <span class="ow">in</span> <span class="n">surrogates</span><span class="p">:</span>
        <span class="c1"># Interpolation data</span>
        <span class="k">if</span> <span class="s2">&quot;interpolation&quot;</span> <span class="ow">in</span> <span class="n">all_metrics</span><span class="p">[</span><span class="n">surrogate</span><span class="p">]:</span>
            <span class="n">interpolation_metrics_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">all_metrics</span><span class="p">[</span><span class="n">surrogate</span><span class="p">][</span><span class="s2">&quot;interpolation&quot;</span><span class="p">][</span><span class="s2">&quot;intervals&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">interpolation_errors_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">all_metrics</span><span class="p">[</span><span class="n">surrogate</span><span class="p">][</span><span class="s2">&quot;interpolation&quot;</span><span class="p">][</span><span class="s2">&quot;model_errors&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Extrapolation data</span>
        <span class="k">if</span> <span class="s2">&quot;extrapolation&quot;</span> <span class="ow">in</span> <span class="n">all_metrics</span><span class="p">[</span><span class="n">surrogate</span><span class="p">]:</span>
            <span class="n">extrapolation_metrics_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">all_metrics</span><span class="p">[</span><span class="n">surrogate</span><span class="p">][</span><span class="s2">&quot;extrapolation&quot;</span><span class="p">][</span><span class="s2">&quot;cutoffs&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">extrapolation_errors_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">all_metrics</span><span class="p">[</span><span class="n">surrogate</span><span class="p">][</span><span class="s2">&quot;extrapolation&quot;</span><span class="p">][</span><span class="s2">&quot;model_errors&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Sparse training data</span>
        <span class="k">if</span> <span class="s2">&quot;sparse&quot;</span> <span class="ow">in</span> <span class="n">all_metrics</span><span class="p">[</span><span class="n">surrogate</span><span class="p">]:</span>
            <span class="n">sparse_metrics_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">all_metrics</span><span class="p">[</span><span class="n">surrogate</span><span class="p">][</span><span class="s2">&quot;sparse&quot;</span><span class="p">][</span><span class="s2">&quot;n_train_samples&quot;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">sparse_errors_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_metrics</span><span class="p">[</span><span class="n">surrogate</span><span class="p">][</span><span class="s2">&quot;sparse&quot;</span><span class="p">][</span><span class="s2">&quot;model_errors&quot;</span><span class="p">])</span>

    <span class="c1"># Create the figure and subplots</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">surrogates</span><span class="p">)))</span>

    <span class="c1"># Interpolation subplot</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">surrogate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">surrogates</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">interpolation_metrics_list</span><span class="p">):</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">interpolation_metrics_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">interpolation_errors_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="n">surrogate</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">interpolation_metrics_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">interpolation_errors_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Interpolation Intervals&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Interpolation&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>

    <span class="c1"># Extrapolation subplot</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">surrogate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">surrogates</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">extrapolation_metrics_list</span><span class="p">):</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">extrapolation_metrics_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">extrapolation_errors_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="n">surrogate</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">extrapolation_metrics_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">extrapolation_errors_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Extrapolation Cutoffs&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Extrapolation&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>

    <span class="c1"># Sparse training subplot</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">surrogate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">surrogates</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sparse_metrics_list</span><span class="p">):</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">sparse_metrics_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">sparse_errors_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">label</span><span class="o">=</span><span class="n">surrogate</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">sparse_metrics_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">sparse_errors_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Number of Training Samples (log scale)&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Sparse Training&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>

    <span class="c1"># Set the x-ticks to all values in sparse_metrics_list</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">sparse_metrics_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">ScalarFormatter</span><span class="p">())</span>

    <span class="c1"># Set the ylabel on the leftmost subplot</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Mean Absolute Error&quot;</span><span class="p">)</span>

    <span class="c1"># Add the legend to the first plot only</span>
    <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s2">&quot;small&quot;</span><span class="p">)</span>

    <span class="c1"># Set the overall title</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Model Errors for Different Modalities&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

    <span class="c1"># Adjust layout to reduce whitespace and improve spacing</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">])</span>

    <span class="n">save_plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="s2">&quot;generalization_error_comparison.png&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="rel_errors_and_uq">
<a class="viewcode-back" href="../../benchmark.html#benchmark.rel_errors_and_uq">[docs]</a>
<span class="k">def</span> <span class="nf">rel_errors_and_uq</span><span class="p">(</span>
    <span class="n">metrics</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">],</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a figure with two subplots: relative errors over time and uncertainty over time for different surrogate models.</span>

<span class="sd">    Args:</span>
<span class="sd">        metrics (dict): Dictionary containing the benchmark metrics for each surrogate model.</span>
<span class="sd">        config (dict): Configuration dictionary.</span>
<span class="sd">        save (bool): Whether to save the plot.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Prepare data for relative errors plot</span>
    <span class="n">mean_errors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">median_errors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">uncertainties</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">absolute_errors</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">timesteps</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">surrogate</span><span class="p">,</span> <span class="n">surrogate_metrics</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">relative_error_model</span> <span class="o">=</span> <span class="n">surrogate_metrics</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;relative_errors&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">relative_error_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mean_errors</span><span class="p">[</span><span class="n">surrogate</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">relative_error_model</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">median_errors</span><span class="p">[</span><span class="n">surrogate</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">relative_error_model</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

        <span class="n">uncertainties</span><span class="p">[</span><span class="n">surrogate</span><span class="p">]</span> <span class="o">=</span> <span class="n">surrogate_metrics</span><span class="p">[</span><span class="s2">&quot;UQ&quot;</span><span class="p">][</span><span class="s2">&quot;pred_uncertainty&quot;</span><span class="p">]</span>
        <span class="n">absolute_errors</span><span class="p">[</span><span class="n">surrogate</span><span class="p">]</span> <span class="o">=</span> <span class="n">surrogate_metrics</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">][</span><span class="s2">&quot;absolute_errors&quot;</span><span class="p">]</span>
        <span class="n">timesteps</span> <span class="o">=</span> <span class="n">surrogate_metrics</span><span class="p">[</span><span class="s2">&quot;timesteps&quot;</span><span class="p">]</span>

    <span class="c1"># Prepare data for uncertainty plot</span>
    <span class="n">pred_unc_time</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">surrogate</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">uncertainty</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">surrogate</span><span class="p">,</span> <span class="n">uncertainty</span> <span class="ow">in</span> <span class="n">uncertainties</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1"># Create subplots</span>
    <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

    <span class="c1"># Plot 1: Relative Errors</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mean_errors</span><span class="p">)))</span>
    <span class="n">linestyles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">surrogate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mean_errors</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mean_errors</span><span class="p">[</span><span class="n">surrogate</span><span class="p">])</span>
        <span class="n">mean_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">surrogate</span><span class="si">}</span><span class="s2"> Mean = </span><span class="si">{</span><span class="n">mean</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> %&quot;</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">timesteps</span><span class="p">,</span>
            <span class="n">mean_errors</span><span class="p">[</span><span class="n">surrogate</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="n">mean_label</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">median_errors</span><span class="p">[</span><span class="n">surrogate</span><span class="p">])</span>
        <span class="n">median_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">surrogate</span><span class="si">}</span><span class="s2"> Median = </span><span class="si">{</span><span class="n">median</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> %&quot;</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">timesteps</span><span class="p">,</span>
            <span class="n">median_errors</span><span class="p">[</span><span class="n">surrogate</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="n">median_label</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">timesteps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">timesteps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Relative Error&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Comparison of Relative Errors Over Time&quot;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>

    <span class="c1"># Plot 2: Uncertainty over Time</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">surrogate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pred_unc_time</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">avg_uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pred_unc_time</span><span class="p">[</span><span class="n">surrogate</span><span class="p">])</span>
        <span class="n">uq_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">surrogate</span><span class="si">}</span><span class="s2"> uncertainty (mean: </span><span class="si">{</span><span class="n">avg_uncertainty</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">timesteps</span><span class="p">,</span>
            <span class="n">pred_unc_time</span><span class="p">[</span><span class="n">surrogate</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="n">uq_label</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">abs_errors_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">absolute_errors</span><span class="p">[</span><span class="n">surrogate</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">abs_error_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">abs_errors_time</span><span class="p">)</span>
        <span class="n">err_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">surrogate</span><span class="si">}</span><span class="s2"> abs. error (mean: </span><span class="si">{</span><span class="n">abs_error_avg</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">timesteps</span><span class="p">,</span>
            <span class="n">abs_errors_time</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">err_label</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">timesteps</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">timesteps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Uncertainty/Absolute Error&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Comparison of Predictive Uncertainty Over Time&quot;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>

    <span class="c1"># Adjust layout</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">])</span>

    <span class="c1"># Save plot if required</span>
    <span class="k">if</span> <span class="n">save</span> <span class="ow">and</span> <span class="n">config</span><span class="p">:</span>
        <span class="n">save_plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="s2">&quot;combined_rel_errors_and_uq.png&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">CODES Benchmark</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../benchmark.html">benchmark module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data.html">data package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../generate_simple_ode_data.html">generate_simple_ode_data module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../make_new_dataset.html">make_new_dataset module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../surrogates.html">surrogates package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../train.html">train module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utils.html">utils package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../run_training.html">run_training module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../run_benchmark.html">run_benchmark module</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Robin Janssen, Immanuel Sulzer.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.0.2</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>